#!/usr/bin/env bash
# Install nginx and configure a 301 redirect for /redirect_me

apt-get update -y
apt-get install -y nginx

# Allow HTTP if firewall is enabled
ufw allow 80/tcp >/dev/null 2>&1 || true

# Add redirect only once
if ! grep -qE 'location\s+~\s+\^\?/redirect_me' /etc/nginx/sites-available/default; then
  sed -i 's/server_name _;/server_name _;\n\n\tlocation ~ ^\/redirect_me\/?$ {\n\t\treturn 301 https:\/\/www.youtube.com\/watch?v=QH2-TGUlwu4;\n\t}\n/' /etc/nginx/sites-available/default
fi

nginx -t
service nginx restart
