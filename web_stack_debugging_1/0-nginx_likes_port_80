#!/usr/bin/env bash
# Fix nginx to listen on port 80 on all IPv4 addresses
conf="$(grep -Rsl 'listen 80' /etc/nginx 2>/dev/null | head -n 1)"
[ -n "$conf" ] && sed -i 's/listen 127.0.0.1:80;/listen 0.0.0.0:80;/; s/listen 80 default_server;/listen 0.0.0.0:80 default_server;/; s/listen 80;/listen 0.0.0.0:80;/' "$conf"
service nginx start || /etc/init.d/nginx start || true
nginx -t && (service nginx restart || /etc/init.d/nginx restart)
